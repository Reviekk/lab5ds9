<!-- SDK PayPal Sandbox -->
<script src="https://www.paypal.com/sdk/js?client-id=AdmzDgq_IhvGu_jImGxvRSy2ZFAD-D49p75TD2DQOoYnwstabxloceh6K6yELG8vQUTi6H-e6v_jl7jQ&currency=USD&components=buttons"></script>

<h1>Procesar Pago</h1>

<div class="row">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Método de Pago</h5>
      </div>
      <div class="card-body">
        <!-- Aquí se muestra el botón de PayPal -->
        <div id="paypal-button-container" style="width: 100%; min-height: 300px;"></div>
      </div>
    </div>
  </div>
  
  <div class="col-md-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Resumen del Pedido</h5>
      </div>
      <div class="card-body">
        <ul class="list-group mb-3">
          <li class="list-group-item"><strong>Orden #:</strong> <%= order.id %></li>
          <li class="list-group-item"><strong>Cliente:</strong> <%= order.firstName %> <%= order.lastName %></li>
          <li class="list-group-item"><strong>Email:</strong> <%= order.email %></li>
          <li class="list-group-item"><strong>Teléfono:</strong> <%= order.phone %></li>
          <li class="list-group-item"><strong>Dirección:</strong> <%= order.address %>, <%= order.city %>, <%= order.province %></li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Total</span>
            <strong>$<%= order.total %></strong>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Script PayPal -->
<script>
  window.addEventListener('load', function () {
    if (typeof paypal === 'undefined') {
      console.error("PayPal SDK no está cargado correctamente.");
      return;
    }

    paypal.Buttons({
      createOrder: function (data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: "<%= order.total %>",
              currency_code: "USD"
            },
            description: "Orden #<%= order.id %>"
          }]
        });
      },
      onApprove: function (data, actions) {
        return actions.order.capture().then(function (details) {
          window.location.href = "/checkout/success?orderId=<%= order.id %>&txId=" + details.id;
        });
      },
      onError: function (err) {
        console.error("Error al procesar el pago:", err);
        window.location.href = "/checkout/failed?orderId=<%= order.id %>";
      },
      onCancel: function () {
        window.location.href = "/checkout/cancel?orderId=<%= order.id %>";
      }
    }).render('#paypal-button-container');
  });
</script>
